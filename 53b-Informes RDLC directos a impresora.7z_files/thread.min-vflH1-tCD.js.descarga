define(["require","exports","tslib","react","classnames","spectrum/tertiary_link","spectrum/tooltip","spectrum_comments/comment","spectrum_comments/thread/thread_editor","prop-types","spectrum_comments/comment_editor/draft_utils","spectrum_comments/comment_utils"],function(e,t,o,n,r,i,s,a,c,l,d,m){"use strict";function p(e,t){return{onDeleted:function(){return t.onCommentDeleted(e.id)},onEdited:function(o){return t.onCommentEdited(e.id,o)},onMentionsQueryUpdated:t.onMentionsQueryUpdated,onClickTimeCode:t.onClickTimeCode,onClickOlderInfo:t.onClickOlderInfo}}Object.defineProperty(t,"__esModule",{value:!0});var h=function(){},u=function(e,t){var o=t.localization,r=e.count,i=o.threadCollapsedCommentsText(r);return n.createElement("div",{className:"sc-thread-comment-number"},i)};u.contextTypes={localization:l.object};var v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isEditorEmpty:!0,shouldFocus:!1},t._isMounted=!1,t.onEditorCancel=t.props.onCancel,t.clickInactive=function(){t.props.onActivated()},t.handleKeyDown=function(e){t.active||13!==e.which||t.props.onActivated()},t.onEditorStateChange=function(e){d.hasFocus(e)&&t.props.actions.onEditorFocused(),t.props.actions.onEditorStateChange(e),t.setState({isEditorEmpty:d.contentIsEmpty(e)})},t.onEditorPost=t.props.actions.onReply,t.onMentionsQueryUpdated=t.props.actions.onMentionsQueryUpdated,t.setRef=function(e){t.ref=e},t}return o.__extends(t,e),Object.defineProperty(t.prototype,"localization",{get:function(){return this.context.localization},enumerable:!0,configurable:!0}),t.prototype.componentDidMount=function(){this._isMounted=!0,this.props.active&&(this.scrollToThread(!1),this.props.onActivated())},t.prototype.componentDidUpdate=function(e){this.props.active&&!e.active?this.scrollToThread():!this.props.active&&e.active&&this.setState({shouldFocus:!1})},t.prototype.componentWillUnmount=function(){this._isMounted=!1},t.prototype.scrollToThread=function(e){var t=this;void 0===e&&(e=!0);var o=this.props.scrollToElem,n=this.ref;n&&o&&o(n).then(function(){t._isMounted&&t.setState({shouldFocus:e})})},Object.defineProperty(t.prototype,"active",{get:function(){return this.props.active||!this.state.isEditorEmpty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){var e=this.props,t=e.className,o=void 0===t?"":t,n=e.thread,i=e.isMobile,s=e.hover;return r(o,{"sc-thread":!0,"sc-thread-active":this.active,"sc-thread-inactive":!this.active,"sc-thread-read":n.read,"sc-thread-unread":!n.read,"sc-thread-resolved":n.resolved,"sc-thread-unresolved":!n.resolved,"sc-thread-mobile":i,"sc-thread-hover":s})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredReplies",{get:function(){var e=this.props.thread.comments;e[0];return e.slice(1).filter(function(e){return!e.deleted})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"includeEditor",{get:function(){var e=this.props,t=e.user,o=e.isMobile;return t&&!o},enumerable:!0,configurable:!0}),t.prototype.renderComment=function(e,t,o,r){void 0===o&&(o=a.Comment);var i=this.props,s=i.actions,c=i.editedComment,l=i.mentionsMatches,d=i.onStartEdit,h=i.onEndEdit,u=i.isMobile,v=!!c&&e.id===c.id;return t||(e=m.truncateComment(e)),n.createElement(o,{actions:p(e,s),active:t,annotation:r,comment:e,key:e.id,isEditing:v,onStartEdit:d,onEndEdit:h,mentionsMatches:l,isMobile:u})},t.prototype.renderReadToggle=function(){var e=this.localization,t=this.props,o=t.actions,r=t.thread,a=r.read?o.onMarkAsUnread:o.onMarkAsRead,c=r.read?e.markAsUnreadLabel:e.markAsReadLabel;return n.createElement(s.Tooltip,{positioning:"above",tooltipContent:c},n.createElement(i.TertiaryLink,{className:"sc-thread-toggle sc-thread-controls-left",onClick:a},c))},t.prototype.renderToplineControls=function(){var e=this.localization,t=this.props,o=t.user,r=t.isMobile,a=t.actions,c=t.thread,l=this.active;return!o||r?null:c.resolved&&l?n.createElement("div",{className:"sc-thread-controls"},n.createElement(s.Tooltip,{positioning:"above",tooltipContent:e.markedAsResolvedLabel},n.createElement("div",{className:"sc-thread-controls-resolved-note sc-thread-controls-left"},e.markedAsResolvedLabel)),n.createElement(s.Tooltip,{positioning:"above",tooltipContent:e.threadRestoreLabel},n.createElement(i.TertiaryLink,{className:"sc-thread-toggle sc-thread-controls-right",onClick:a.onUnresolve},e.threadRestoreLabel))):l?n.createElement("div",{className:"sc-thread-controls"},this.renderReadToggle(),n.createElement(s.Tooltip,{positioning:"above",tooltipContent:e.threadResolveLabel},n.createElement(i.TertiaryLink,{className:"sc-thread-toggle sc-thread-controls-right",onClick:a.onResolve},e.threadResolveLabel))):null},t.prototype.renderActive=function(){var e=this,t=this.props,o=t.actions,r=o.onMouseEnter,i=o.onMouseLeave,s=t.commentComponent,l=t.mentionsMatches,d=t.thread,m=t.user,p=(t.isMobile,this.filteredReplies);return n.createElement("li",{onMouseEnter:r,onMouseLeave:i,className:this.className,ref:this.setRef},this.renderToplineControls(),n.createElement("ul",{className:"sc-thread-comments"},this.renderComment(d.comments[0],this.active,s,d.annotation),p.map(function(t){return e.renderComment(t,!0,a.Comment)})),this.includeEditor&&n.createElement(c.ThreadEditor,{author:m,shouldFocus:this.state.shouldFocus,mentionsMatches:l,onCancel:this.onEditorCancel,onEditorStateChange:this.onEditorStateChange,onMentionsQueryUpdated:this.onMentionsQueryUpdated,onPost:this.onEditorPost}))},t.prototype.renderInactive=function(){var e=this.props,t=e.actions,o=t.onMouseEnter,r=t.onMouseLeave,i=e.active,s=e.commentComponent,c=void 0===s?a.Comment:s,l=e.mentionsMatches,d=(e.onActivated,e.thread),p=e.isMobile,v=(e.user,this.filteredReplies);return n.createElement("li",{className:this.className,tabIndex:0,onClick:this.clickInactive,onKeyDown:this.handleKeyDown,onMouseEnter:o,onMouseLeave:r,ref:this.setRef},this.renderToplineControls(),n.createElement("ul",{className:"sc-thread-comments"},this.renderComment(d.comments[0],i,c,d.annotation),v.length>1&&n.createElement(u,{count:v.length-1}),v.length>0&&n.createElement(a.Comment,{active:!1,comment:m.truncateComment(v[v.length-1]),actions:{onClickTimeCode:h,onDeleted:h,onEdited:h,onMentionsQueryUpdated:h,onClickOlderInfo:h},mentionsMatches:l,onEndEdit:h,onStartEdit:h,isEditing:!1,isMobile:p})),this.includeEditor&&n.createElement("div",{className:"sc-thread-reply-hint"},this.localization.replyHintLabel||"Replyâ€¦"))},t.prototype.render=function(){return this.props.thread.comments.every(function(e){return!!e.deleted})?null:this.active?this.renderActive():this.renderInactive()},t.contextTypes={localization:l.object},t})(n.PureComponent);t.Thread=v});
//# sourceMappingURL=thread.min.js-vfl61U368.map